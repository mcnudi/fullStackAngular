<!-- Sección superior -->
<div class="info-usuario-up pt-4" style="background: #f6faf4; min-height: 50vh;">
  <div class="wrapper-padding" style="padding: 0 1rem;"> <!-- Reducido de 2rem a 1rem -->
    <div class="container">
      <div class="row">

        <!-- Columna izquierda -->
        <div class="col-3 d-flex flex-column align-items-center justify-content-start pt-4" style="background: #f6faf4;">
          <!-- Imagen de usuario -->
          <div class="mb-3">
            <img
              src="https://images.unsplash.com/photo-1502685104226-ee32379fefbe?auto=format&fit=crop&w=120&q=80"
              alt="Usuario"
              class="img-fluid rounded-circle"
              style="width: 120px; height: 120px; object-fit: cover;"
            />
          </div>

          <!-- Título y subtítulo -->
          <div class="text-center mb-3 pd-3">
            <div class="fw-bold" style="font-size: 1.1rem;">
            {{username}}
            </div>
            <div style="font-size: 0.95rem; color: #555;">
              Gráficos/Estadísticas
            </div>
          </div>

          <!-- Gráfico -->
          <div style="width: 280px; margin: 0 auto; position: relative;">
            <!-- Flecha izquierda -->
            <button
              (click)="chartType = 'pie'"
              style="position: absolute; left: -25px; top: 50%; transform: translateY(-50%); background: none; border: none;">
              ◀
            </button>

            <!-- Flecha derecha -->
            <button
              (click)="chartType = 'bar'"
              style="position: absolute; right: -25px; top: 50%; transform: translateY(-50%); background: none; border: none;">
              ▶
            </button>

            <!-- Gráfico dinámico -->
            @if (chartType === 'pie') {
              <ngx-charts-pie-chart
                [view]="[280, 180]"
                [results]="single"
                [scheme]="'fire'"
                [gradient]="false"
                [legend]="true"
                [legendPosition]="legendPosition"
                [labels]="true"
                [doughnut]="false"
              >
              </ngx-charts-pie-chart>
            }

            @if (chartType === 'bar') {
              <ngx-charts-bar-vertical
                [view]="[280, 180]"
                [results]="barChartData"
                [scheme]="'fire'"
                [gradient]="false"
                [legend]="true"
                [xAxis]="true"
                [yAxis]="true"
                [legendPosition]="legendPosition"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                xAxisLabel="Categoría"
                yAxisLabel="Valor"
              >
              </ngx-charts-bar-vertical>
            }
          </div>
        </div>

        <!-- Columna derecha -->
        <div class="col-9 d-flex flex-column px-3" style="background: #fff;"> <!-- Reducido px-5 a px-3 -->
          <div class="pt-3 pb-2"> <!-- Reducido pt-4 a pt-3 -->
            <h5 class="fw-bold mb-2">Actividades de la Semana</h5>
            <hr class="mb-3" style="margin-bottom: 0.75rem;" />

            <div
              class="objetivos-list bg-light rounded p-2 mb-4"
              style="overflow-y: auto; max-height: 220px;"
            >
              <ul class="list-unstyled mb-0">
                @for (objetivo of objetivos; track $index) {
                  <li class="d-flex justify-content-between align-items-center mb-2">
                    <span class="text-truncate" style="max-width: 70%;">
                      {{objetivo.goals_name}}
                    </span>
                    <button class="btn btn-sm btn-outline-secondary">Ver</button>
                  </li>
                }
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sección inferior: Calendario -->
<div class="row">
  <!-- Columna de filtros -->
  <div class="col-2 d-flex flex-column align-items-start pt-4" style="background: #f6faf4;">
    <h6 class="fw-bold mb-3">Filtros</h6>
    <div class="mb-2 w-100">
      <label class="form-label">Tipo de evento</label>
      <select class="form-select" [(ngModel)]="filtroTipo">
        <option value="">Todos</option>
        <option value="disponibilidad">Disponibilidad</option>
        <option value="actividad">Actividad</option>
      </select>
    </div>
    <button class="btn btn-info w-100 mt-2" (click)="aplicarFiltros()">Aplicar</button>
    <button class="btn btn-outline-secondary w-100 mt-2" (click)="limpiarFiltros()">Limpiar</button>
  </div>

  <!-- Columna principal (calendario y resto del dashboard) -->
  <div class="col-10">
    <div
      class="calendario bg-white rounded shadow-sm p-3 w-100"
      style="max-width: 1100px; min-height: 400px; max-height: 900px; overflow-y: auto; overflow-x: hidden;"
    >
      <full-calendar
        [options]="calendarOptions"
        style="width: 100%;"
      ></full-calendar>
    </div>
  </div>
</div>