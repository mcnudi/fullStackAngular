<div class="mt-3" style="height: 100vh; display: flex; flex-direction: column">
  <div class="info-usuario-up" style="flex: 1">
    <div class="container h-100">
      <div class="row g-4 h-100">
        <div class="col-3">
          <div
            class="bg-white rounded shadow-sm p-3 text-center h-100 d-flex flex-column"
          >
            <div>
              <div class="mb-2">
                <img
                  [src]="profileImage"
                  alt="Usuario"
                  class="img-fluid rounded-circle"
                  style="width: 120px; height: 120px; object-fit: cover"
                />
              </div>
              <div class="mb-3">
                <div class="fw-bold" style="font-size: 1.1rem">
                  {{ username }}
                </div>
              </div>
            </div>

            <div class="text-start mt-4 p-3 ">

              <div class="mb-4">
                <label for="routine-select" class="form-label text-muted mb-1"
                  >Seleccionar Rutina</label
                >
                @if (rutinas.length > 0 && rutinaSeleccionada !== null) {
                <select
                  id="routine-select"
                  [(ngModel)]="rutinaSeleccionada"
                  class="form-select form-select-lg"
                  (ngModelChange)="aplicarFiltros()"
                >
                  @for (rutina of rutinas; track $index) {
                  <option [value]="rutina.id">{{ rutina.name }}</option>
                  }
                </select>
                } @else {
                <select
                  id="routine-select"
                  class="form-select form-select-lg"
                  disabled
                >
                  <option>Cargando rutinas...</option>
                </select>
                }
              </div>

              <div class="mb-4">
                <label
                  for="event-type-select"
                  class="form-label text-muted mb-1"
                  >Tipo de Evento</label
                >
                <select
                  id="event-type-select"
                  class="form-select form-select-lg"
                  [(ngModel)]="filtroTipo"
                  (ngModelChange)="aplicarFiltros()"
                >
                  <option value="">Todos los eventos</option>
                  <option value="disponibilidad">Disponibilidad</option>
                  <option value="actividad">Actividad</option>
                </select>
              </div>
              <div class="d-grid">
                <button
                  class="btn btn-outline-secondary btn-lg"
                  (click)="limpiarFiltros()"
                >
                  Limpiar Filtros
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-9">
          <div
            class="bg-white rounded shadow-sm p-4 actividades-wrapper h-100 d-flex flex-column"
          >
            <h2 class="fw-bold mb-2">ACTIVIDADES DE LA SEMANA</h2>
            <hr class="mb-3" />
            <div
              class="objetivos-list rounded p-3 flex-grow-1"
                      style="
          max-width: auto;
          min-height: 100px;
          max-height: 420px;
          overflow-y: auto;
          overflow-x: hidden;
        "
            >
              <ul class="list-unstyled mb-0">
                @if(actividades.length>0){ @for (actividad of actividades; track
                $index) {
                <li
                  class="actividad-item d-flex justify-content-between align-items-center mb-2 p-2 border rounded bg-white shadow-sm"
                >
                  <div class="actividad-info text-truncate">
                    <strong class="actividad-titulo d-block">{{
                      actividad.title
                    }}</strong>
                    <small class="actividad-horario text-muted"
                      >{{ actividad.start_time }} -
                      {{ actividad.end_time }}</small
                    >
                  </div>
                  <button
                    class="btn btn-sm btn-custom btn-actividad px-4"
                    (click)="verActividad(actividad)"
                  >
                    Ver
                  </button>
                </li>
                } } @else {
                <div class="sin-actividades-container text-center">
                  <img
                    src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXA5c25iMmlndWk2MHp5ZXZ2bjd0aXp4Yzdiemg1dnVocGh1MTN6ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/jls5k3a7L1N0XRM9d0/giphy.gif"
                    alt="Sin actividades"
                    style="max-width: 100%; height: auto"
                  />
                  <h3 class="mt-3">Ups... no tienes actividades aún</h3>
                  <p>¡Empieza creando tus primeras tareas y rutinas!</p>
                </div>
                }
              </ul>
            </div>
            @if (!mostrarFormularioActividad) {
            <button
              (click)="abrirFormularioActividad()"
              class="btn-info mt-2 btn-primary-color btn-custom mb-3 mx-auto centered-button"
            >
              Agrega Actividad
            </button>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container my-4">
    <div class="row"></div>

    <div class="col-12">
      <div
        class="calendario bg-white rounded shadow-sm p-3 w-100"
        style="
          max-width: auto;
          min-height: 400px;
          max-height: 900px;
          overflow-y: auto;
          overflow-x: hidden;
        "
      >
        <full-calendar
          [options]="calendarOptions"
          style="width: 100%"
        ></full-calendar>
      </div>
    </div>
  </div>
</div>

@if (mostrarFormularioActividad) {
<div class="modal-overlay" (click)="cerrarFormularioActividad()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-form-activity
      [objetoRutinaDefecto]="objetoRutinaDefecto"
      [rutinaSeleccionada]="rutinaSeleccionada"
      [disponibilidad]="availability"
      [actividades]="actividades"
      [categorias]="categorias"
      (cerrar)="cerrarFormularioActividad()"
    ></app-form-activity>
  </div>
</div>
} @if (mostrarVistaActividad) {
<div class="modal-overlay" (click)="cerrarVistaActividad()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-form-info-activity
      [actividad]="actividadSeleccionada"
      (cerrar)="cerrarVistaActividad()"
    ></app-form-info-activity>
  </div>
</div>
}
