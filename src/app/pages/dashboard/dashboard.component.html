<!-- Contenedor principal que ocupa toda la pantalla y divide en dos partes iguales -->
<div class="mt-3" style="height: 100vh; display: flex; flex-direction: column">
  <!-- Sección superior: 50% altura -->
  <div class="info-usuario-up" style="background: #f6faf4; flex: 1">
    <div class="container h-100">
      <div class="row g-4 h-100">
        <!-- Columna izquierda -->
        <div class="col-3">
          <div
            class="bg-white rounded shadow-sm p-3 text-center h-100 d-flex flex-column"
          >
            <!-- Imagen y nombre juntos arriba -->
            <div>
              <!-- Imagen de usuario -->
              <div class="mb-2">
                <img
                  [src]="profileImage"
                  alt="Usuario"
                  class="img-fluid rounded-circle"
                  style="width: 120px; height: 120px; object-fit: cover"
                />
              </div>
              <!-- Título y subtítulo -->
              <div class="mb-1">
                <div class="fw-bold" style="font-size: 1.1rem">
                  {{ username }}
                </div>
                <div style="font-size: 0.95rem; color: #555">
                  Gráficos/Estadísticas
                </div>
              </div>
            </div>

            <!-- Gráfico ocupa el espacio restante -->
            <div style="position: relative">
              <button
                (click)="chartType = 'pie'"
                class="btn btn-link position-absolute top-50 start-0 translate-middle-y px-1"
              >
                ◀
              </button>

              <button
                (click)="chartType = 'bar'"
                class="btn btn-link position-absolute top-50 end-0 translate-middle-y px-1"
              >
                ▶
              </button>

              <div
                class="px-3 h-100 d-flex align-items-center justify-content-center"
              >
                @if (chartType === 'pie') {
                <ngx-charts-pie-chart
                  [view]="[240, 180]"
                  [results]="pieChartData"
                  [scheme]="'fire'"
                  [gradient]="false"
                  [legend]="true"
                  [legendPosition]="legendPosition"
                  [labels]="true"
                  [doughnut]="false"
                ></ngx-charts-pie-chart>
                } @if (chartType === 'bar') {
                <ngx-charts-bar-vertical
                  [view]="[240, 180]"
                  [results]="barChartData"
                  [scheme]="'fire'"
                  [gradient]="false"
                  [legend]="true"
                  [xAxis]="true"
                  [yAxis]="true"
                  [legendPosition]="legendPosition"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  xAxisLabel="Categoría"
                  yAxisLabel="Valor"
                ></ngx-charts-bar-vertical>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Columna derecha -->
        <div class="col-9">
          <div
            class="bg-white rounded shadow-sm p-4 actividades-wrapper h-100 d-flex flex-column"
          >
            <h2 class="fw-bold mb-2">ACTIVIDADES DE LA SEMANA</h2>
            <hr class="mb-3" />
            <div
              class="objetivos-list rounded p-3 flex-grow-1"
              style="overflow-y: auto"
            >
              <ul class="list-unstyled mb-0">
                @if(actividades.length>0){
                  @for (actividad of actividades; track $index) {
                    <li
                      class="actividad-item d-flex justify-content-between align-items-center mb-2 p-2 border rounded bg-white shadow-sm"
                    >
                      <div class="actividad-info text-truncate">
                        <strong class="actividad-titulo d-block">{{
                          actividad.title
                        }}</strong>
                        <small class="actividad-horario text-muted"
                          >{{ actividad.start_time }} -
                          {{ actividad.end_time }}</small
                        >
                      </div>
                      <button
                        class="btn btn-sm btn-custom btn-actividad px-4"
                        (click)="verActividad(actividad)"
                      >
                        Ver
                      </button>
                    </li>
                  }
                } @else {
                <div class="sin-actividades-container text-center">
                  <img
                    src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXA5c25iMmlndWk2MHp5ZXZ2bjd0aXp4Yzdiemg1dnVocGh1MTN6ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/jls5k3a7L1N0XRM9d0/giphy.gif"
                    alt="Sin actividades"
                    style="max-width: 100%; height: auto"
                  />
                  <h3 class="mt-3">Ups... no tienes actividades aún</h3>
                  <p>¡Empieza creando tus primeras tareas y rutinas!</p>
                </div>
                }
              </ul>
            </div>
            @if (!mostrarFormularioActividad) {
            <button
              (click)="abrirFormularioActividad()"
              class="btn-info mt-2 btn-primary-color btn-custom mb-3 mx-auto centered-button"
            >
              Agrega Actividad
            </button>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección inferior: Calendario -->
  <div class="container my-4">
    <div class="row">
      <div
        class="col-2 d-flex flex-column align-items-start pt-4"
        style="background: #f6faf4"
      >
        <h6 class="fw-bold mb-3">Filtros</h6>
        <div class="mb-2 w-100">
          <label class="form-label">Rutina</label>

          @if (rutinas) {
            <select [(ngModel)]="rutinaSeleccionada" class="form-select">
              @for (rutina of rutinas; track $index) {
                <option [value]="rutina.id">{{ rutina.name }}</option>
              }
            </select>
          }
        </div>
        <div class="mb-2 w-100">
          <label class="form-label">Tipo de evento</label>
          <select class="form-select" [(ngModel)]="filtroTipo">
            <option value="">Todos</option>
            <option value="disponibilidad">Disponibilidad</option>
            <option value="actividad">Actividad</option>
          </select>
        </div>
        <button class="btn btn-info w-100 mt-2" (click)="aplicarFiltros()">
          Aplicar
        </button>
        <button
          class="btn btn-outline-secondary w-100 mt-2"
          (click)="limpiarFiltros()"
        >
          Limpiar
        </button>
      </div>

      <div class="col-10">
        <div
          class="calendario bg-white rounded shadow-sm p-3 w-100"
          style="
            max-width: 1100px;
            min-height: 400px;
            max-height: 900px;
            overflow-y: auto;
            overflow-x: hidden;
          "
        >
          <full-calendar
            [options]="calendarOptions"
            style="width: 100%"
          ></full-calendar>
        </div>
      </div>
    </div>
  </div>
</div>

@if (mostrarFormularioActividad) {
<div class="modal-overlay" (click)="cerrarFormularioActividad()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-form-activity
     [rutinasDisponibles]="rutinas"
     [disponibilidad]="availability"
     [actividades]="actividades"
      (cerrar)="cerrarFormularioActividad()"
    ></app-form-activity>
  </div>
</div>
} @if (mostrarVistaActividad) {
<div class="modal-overlay" (click)="cerrarVistaActividad()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-form-info-activity
      [actividad]="actividadSeleccionada"
      (cerrar)="cerrarVistaActividad()"
    ></app-form-info-activity>
  </div>
</div>
}
